<?php

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function omnipedia_user_help(
  string $routeName, RouteMatchInterface $routeMatch
) {

  switch ($routeName) {
    case 'user.login':
    case 'user.pass':

      /** @var \Drupal\omnipedia_commerce\Service\ContentAccessProductInterface */
      $contentAccessProduct = \Drupal::service(
        'omnipedia_commerce.content_access_product'
      );

      /** @var \Drupal\Core\Session\AccountInterface */
      $currentUser = \Drupal::service('current_user');

      /** @var \Drupal\commerce_product\Entity\ProductInterface|null */
      $product = $contentAccessProduct->getBaseProduct();

      // Don't render anything if the base product has not been configured.
      if (
        !\is_object($product) ||
        !$product->access('view', $currentUser)
      ) {
        return '';
      }

      /** @var \Drupal\Core\Utility\LinkGeneratorInterface The Drupal link generator service. */
      $linkGenerator = \Drupal::service('link_generator');

      return '<p>'. \t(
        'Don\'t have an account? You can acquire one by @joining.',
        ['@joining' => $linkGenerator->generate(
          \t('joining Omnipedia'),
          $product->toUrl()
        )]
      ) . '</p>';

  }

}
